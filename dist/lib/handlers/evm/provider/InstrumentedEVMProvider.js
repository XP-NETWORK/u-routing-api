import { ethers } from 'ethers';
import { metric, MetricLoggerUnit } from '@uniswap/smart-order-router';
export class InstrumentedEVMProvider extends ethers.providers.StaticJsonRpcProvider {
    constructor({ url, network, name }) {
        super(url, network);
        this.name = name;
        this.metricPrefix = `RPC_${this.name}_${this.network.chainId}`;
    }
    call(transaction, blockTag) {
        const before = Date.now();
        const result = super
            .call(transaction, blockTag)
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_CALL_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_CALL_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => {
            metric.putMetric(`${this.metricPrefix}_CALL_REQUESTED`, 1, MetricLoggerUnit.Count);
            metric.putMetric(`${this.metricPrefix}_CALL_LATENCY`, Date.now() - before, MetricLoggerUnit.Milliseconds);
        });
        return result;
    }
    estimateGas(transaction) {
        return super
            .estimateGas(transaction)
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_ESTIMATEGAS_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_ESTIMATEGAS_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_ESTIMATEGAS_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
    getBalance(addressOrName, blockTag) {
        return super
            .getBalance(addressOrName, blockTag)
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_GETBALANCE_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_GETBALANCE_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_GETBALANCE_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
    getBlock(blockHashOrBlockTag) {
        return super
            .getBlock(blockHashOrBlockTag)
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_GETBLOCK_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_GETBLOCK_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_GETBLOCK_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
    getBlockNumber() {
        return super
            .getBlockNumber()
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_GETBLOCKNUMBER_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_GETBLOCKNUMBER_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_GETBLOCKNUMBER_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
    getBlockWithTransactions(blockHashOrBlockTag) {
        return super
            .getBlockWithTransactions(blockHashOrBlockTag)
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_GETBLOCKWITHTRANSACTION_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_GETBLOCKWITHTRANSACTION_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_GETBLOCKWITHTRANSACTION_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
    getCode(addressOrName, blockTag) {
        return super
            .getCode(addressOrName, blockTag)
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_GETCODE_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_GETCODE_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_GETCODE_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
    getGasPrice() {
        return super
            .getGasPrice()
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_GETGASPRICE_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_GETGASPRICE_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_GETGASPRICE_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
    getLogs(filter) {
        return super
            .getLogs(filter)
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_GETLOGS_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_GETLOGS_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_GETLOGS_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
    getNetwork() {
        return super
            .getNetwork()
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_GETNETWORK_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_GETNETWORK_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_GETNETWORK_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
    getStorageAt(addressOrName, position, blockTag) {
        return super
            .getStorageAt(addressOrName, position, blockTag)
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_GETSTORAGEAT_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_GETSTORAGEAT_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_GETSTORAGEAT_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
    getTransaction(transactionHash) {
        return super
            .getTransaction(transactionHash)
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_GETTRANSACTION_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_GETTRANSACTION_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_GETTRANSACTION_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
    getTransactionCount(addressOrName, blockTag) {
        return super
            .getTransactionCount(addressOrName, blockTag)
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_GETTRANSACTIONCOUNT_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_GETTRANSACTIONCOUNT_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_GETTRANSACTIONCOUNT_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
    getTransactionReceipt(transactionHash) {
        return super
            .getTransactionReceipt(transactionHash)
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_GETTRANSACTIONRECEIPT_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_GETTRANSACTIONRECEIPT_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_GETTRANSACTIONRECEIPT_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
    lookupAddress(address) {
        return super
            .lookupAddress(address)
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_LOOKUPADDRESS_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_LOOKUPADDRESS_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_LOOKUPADDRESS_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
    resolveName(name) {
        return super
            .resolveName(name)
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_RESOLVENAME_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_RESOLVENAME_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_RESOLVENAME_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
    sendTransaction(signedTransaction) {
        return super
            .sendTransaction(signedTransaction)
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_SENDTRANSACTION_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_SENDTRANSACTION_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_SENDTRANSACTION_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
    waitForTransaction(transactionHash, confirmations, timeout) {
        return super
            .waitForTransaction(transactionHash, confirmations, timeout)
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_WAITFORTRANSACTION_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_WAITFORTRANSACTION_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_WAITFORTRANSACTION_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSW5zdHJ1bWVudGVkRVZNUHJvdmlkZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9saWIvaGFuZGxlcnMvZXZtL3Byb3ZpZGVyL0luc3RydW1lbnRlZEVWTVByb3ZpZGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxRQUFRLENBQUE7QUFZL0IsT0FBTyxFQUFFLE1BQU0sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLDZCQUE2QixDQUFBO0FBWXRFLE1BQU0sT0FBTyx1QkFBd0IsU0FBUSxNQUFNLENBQUMsU0FBUyxDQUFDLHFCQUFxQjtJQUlqRixZQUFZLEVBQUUsR0FBRyxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQWdDO1FBQzlELEtBQUssQ0FBQyxHQUFHLEVBQUUsT0FBTyxDQUFDLENBQUE7UUFDbkIsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUE7UUFDaEIsSUFBSSxDQUFDLFlBQVksR0FBRyxPQUFPLElBQUksQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsQ0FBQTtJQUNoRSxDQUFDO0lBRVEsSUFBSSxDQUFDLFdBQTJDLEVBQUUsUUFBdUM7UUFDaEcsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFBO1FBQ3pCLE1BQU0sTUFBTSxHQUFHLEtBQUs7YUFDakIsSUFBSSxDQUFDLFdBQVcsRUFBRSxRQUFRLENBQUM7YUFDM0IsSUFBSSxDQUNILENBQUMsUUFBUSxFQUFFLEVBQUU7WUFDWCxNQUFNLENBQUMsU0FBUyxDQUFDLEdBQUcsSUFBSSxDQUFDLFlBQVksZUFBZSxFQUFFLENBQUMsRUFBRSxnQkFBZ0IsQ0FBQyxLQUFLLENBQUMsQ0FBQTtZQUNoRixPQUFPLFFBQVEsQ0FBQTtRQUNqQixDQUFDLEVBQ0QsQ0FBQyxLQUFLLEVBQUUsRUFBRTtZQUNSLE1BQU0sQ0FBQyxTQUFTLENBQUMsR0FBRyxJQUFJ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LElBQUksQ0FBQyxZQUFZLDZCQUE2QixFQUFFLENBQUMsRUFBRSxnQkFBZ0IsQ0FBQyxLQUFLLENBQUMsQ0FBQTtZQUM5RixNQUFNLEtBQUssQ0FBQTtRQUNiLENBQUMsQ0FDRjthQUNBLE9BQU8sQ0FBQyxHQUFHLEVBQUUsQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLEdBQUcsSUFBSSxDQUFDLFlBQVksK0JBQStCLEVBQUUsQ0FBQyxFQUFFLGdCQUFnQixDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUE7SUFDcEgsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZXRoZXJzIH0gZnJvbSAnZXRoZXJzJ1xuaW1wb3J0IHsgRGVmZXJyYWJsZSB9IGZyb20gJ0BldGhlcnNwcm9qZWN0L3Byb3BlcnRpZXMnXG5pbXBvcnQgeyBUcmFuc2FjdGlvblJlcXVlc3QgfSBmcm9tICdAZXRoZXJzcHJvamVjdC9wcm92aWRlcnMnXG5pbXBvcnQge1xuICBCbG9jayxcbiAgQmxvY2tUYWcsXG4gIEJsb2NrV2l0aFRyYW5zYWN0aW9ucyxcbiAgRmlsdGVyLFxuICBMb2csXG4gIFRyYW5zYWN0aW9uUmVjZWlwdCxcbiAgVHJhbnNhY3Rpb25SZXNwb25zZSxcbn0gZnJvbSAnQGV0aGVyc3Byb2plY3QvYWJzdHJhY3QtcHJvdmlkZXInXG5pbXBvcnQgeyBtZXRyaWMsIE1ldHJpY0xvZ2dlclVuaXQgfSBmcm9tICdAdW5pc3dhcC9zbWFydC1vcmRlci1yb3V0ZXInXG5pbXBvcnQgeyBCaWdOdW1iZXIsIEJpZ051bWJlcmlzaCB9IGZyb20gJ0BldGhlcnNwcm9qZWN0L2JpZ251bWJlcidcbmltcG9ydCB7IE5ldHdvcmssIE5ldHdvcmtpc2ggfSBmcm9tICdAZXRoZXJzcHJvamVjdC9uZXR3b3JrcydcbmltcG9ydCB7IENvbm5lY3Rpb25JbmZvIH0gZnJvbSAnQGV0aGVyc3Byb2plY3Qvd2ViJ1xuaW1wb3J0IHsgUHJvdmlkZXJOYW1lIH0gZnJvbSAnLi9Qcm92aWRlck5hbWUnXG5cbmV4cG9ydCB0eXBlIEluc3RydW1lbnRlZEVWTVByb3ZpZGVyUHJvcHMgPSB7XG4gIHVybD86IENvbm5lY3Rpb25JbmZvIHwgc3RyaW5nXG4gIG5ldHdvcms/OiBOZXR3b3JraXNoXG4gIG5hbWU6IFByb3ZpZGVyTmFtZVxufVxuXG5leHBvcnQgY2xhc3MgSW5zdHJ1bWVudGVkRVZNUHJvdmlkZXIgZXh0ZW5kcyBldGhlcnMucHJvdmlkZXJzLlN0YXRpY0pzb25ScGNQcm92aWRlciB7XG4gIHByaXZhdGUgcmVhZG9ubHkgbmFtZTogUHJvdmlkZXJOYW1lXG4gIHByaXZhdGUgcmVhZG9ubHkgbWV0cmljUHJlZml4OiBzdHJpbmdcblxuICBjb25zdHJ1Y3Rvcih7IHVybCwgbmV0d29yaywgbmFtZSB9OiBJbnN0cnVtZW50ZWRFVk1Qcm92aWRlclByb3BzKSB7XG4gICAgc3VwZXIodXJsLCBuZXR3b3JrKVxuICAgIHRoaXMubmFtZSA9IG5hbWVcbiAgICB0aGlzLm1ldHJpY1ByZWZpeCA9IGBSUENfJHt0aGlzLm5hbWV9XyR7dGhpcy5uZXR3b3JrLmNoYWluSWR9YFxuICB9XG5cbiAgb3ZlcnJpZGUgY2FsbCh0cmFuc2FjdGlvbjogRGVmZXJyYWJsZTxUcmFuc2FjdGlvblJlcXVlc3Q+LCBibG9ja1RhZz86IEJsb2NrVGFnIHwgUHJvbWlzZTxCbG9ja1RhZz4pOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGNvbnN0IGJlZm9yZSA9IERhdGUubm93KClcbiAgICBjb25zdCByZXN1bHQgPSBzdXBlclxuICAgICAgLmNhbGwodHJhbnNhY3Rpb24sIGJsb2NrVGFnKVxuICAgICAgLnRoZW4oXG4gICAgICAgIChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgIG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X0NBTExfU1VDQ0VTU2AsIDEsIE1ldHJpY0xvZ2dlclVuaXQuQ291bnQpXG4gICAgICAgICAgcmV0dXJuIHJlc3BvbnNlXG4gICAgICAgIH0sXG4gICAgICAgIChlcnJvcikgPT4ge1xuICAgICAgICAgIG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X0NBTExfRkFJTFVSRWAsIDEsIE1ldHJpY0xvZ2dlclVuaXQuQ291bnQpXG4gICAgICAgICAgdGhyb3cgZXJyb3JcbiAgICAgICAgfVxuICAgICAgKVxuICAgICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgICBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9DQUxMX1JFUVVFU1RFRGAsIDEsIE1ldHJpY0xvZ2dlclVuaXQuQ291bnQpXG4gICAgICAgIG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X0NBTExfTEFURU5DWWAsIERhdGUubm93KCkgLSBiZWZvcmUsIE1ldHJpY0xvZ2dlclVuaXQuTWlsbGlzZWNvbmRzKVxuICAgICAgfSlcblxuICAgIHJldHVybiByZXN1bHRcbiAgfVxuXG4gIG92ZXJyaWRlIGVzdGltYXRlR2FzKHRyYW5zYWN0aW9uOiBEZWZlcnJhYmxlPFRyYW5zYWN0aW9uUmVxdWVzdD4pOiBQcm9taXNlPEJpZ051bWJlcj4ge1xuICAgIHJldHVybiBzdXBlclxuICAgICAgLmVzdGltYXRlR2FzKHRyYW5zYWN0aW9uKVxuICAgICAgLnRoZW4oXG4gICAgICAgIChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgIG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X0VTVElNQVRFR0FTX1NVQ0NFU1NgLCAxLCBNZXRyaWNMb2dnZXJVbml0LkNvdW50KVxuICAgICAgICAgIHJldHVybiByZXNwb25zZVxuICAgICAgICB9LFxuICAgICAgICAoZXJyb3IpID0+IHtcbiAgICAgICAgICBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9FU1RJTUFURUdBU19GQUlMVVJFYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudClcbiAgICAgICAgICB0aHJvdyBlcnJvclxuICAgICAgICB9XG4gICAgICApXG4gICAgICAuZmluYWxseSgoKSA9PiBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9FU1RJTUFURUdBU19SRVFVRVNURURgLCAxLCBNZXRyaWNMb2dnZXJVbml0LkNvdW50KSlcbiAgfVxuXG4gIG92ZXJyaWRlIGdldEJhbGFuY2UoXG4gICAgYWRkcmVzc09yTmFtZTogc3RyaW5nIHwgUHJvbWlzZTxzdHJpbmc+LFxuICAgIGJsb2NrVGFnPzogQmxvY2tUYWcgfCBQcm9taXNlPEJsb2NrVGFnPlxuICApOiBQcm9taXNlPEJpZ051bWJlcj4ge1xuICAgIHJldHVybiBzdXBlclxuICAgICAgLmdldEJhbGFuY2UoYWRkcmVzc09yTmFtZSwgYmxvY2tUYWcpXG4gICAgICAudGhlbihcbiAgICAgICAgKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fR0VUQkFMQU5DRV9TVUNDRVNTYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudClcbiAgICAgICAgICByZXR1cm4gcmVzcG9uc2VcbiAgICAgICAgfSxcbiAgICAgICAgKGVycm9yKSA9PiB7XG4gICAgICAgICAgbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fR0VUQkFMQU5DRV9GQUlMVVJFYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudClcbiAgICAgICAgICB0aHJvdyBlcnJvclxuICAgICAgICB9XG4gICAgICApXG4gICAgICAuZmluYWxseSgoKSA9PiBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9HRVRCQUxBTkNFX1JFUVVFU1RFRGAsIDEsIE1ldHJpY0xvZ2dlclVuaXQuQ291bnQpKVxuICB9XG5cbiAgb3ZlcnJpZGUgZ2V0QmxvY2soYmxvY2tIYXNoT3JCbG9ja1RhZzogQmxvY2tUYWcgfCBzdHJpbmcgfCBQcm9taXNlPEJsb2NrVGFnIHwgc3RyaW5nPik6IFByb21pc2U8QmxvY2s+IHtcbiAgICByZXR1cm4gc3VwZXJcbiAgICAgIC5nZXRCbG9jayhibG9ja0hhc2hPckJsb2NrVGFnKVxuICAgICAgLnRoZW4oXG4gICAgICAgIChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgIG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X0dFVEJMT0NLX1NVQ0NFU1NgLCAxLCBNZXRyaWNMb2dnZXJVbml0LkNvdW50KVxuICAgICAgICAgIHJldHVybiByZXNwb25zZVxuICAgICAgICB9LFxuICAgICAgICAoZXJyb3IpID0+IHtcbiAgICAgICAgICBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9HRVRCTE9DS19GQUlMVVJFYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudClcbiAgICAgICAgICB0aHJvdyBlcnJvclxuICAgICAgICB9XG4gICAgICApXG4gICAgICAuZmluYWxseSgoKSA9PiBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9HRVRCTE9DS19SRVFVRVNURURgLCAxLCBNZXRyaWNMb2dnZXJVbml0LkNvdW50KSlcbiAgfVxuXG4gIG92ZXJyaWRlIGdldEJsb2NrTnVtYmVyKCk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgcmV0dXJuIHN1cGVyXG4gICAgICAuZ2V0QmxvY2tOdW1iZXIoKVxuICAgICAgLnRoZW4oXG4gICAgICAgIChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgIG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X0dFVEJMT0NLTlVNQkVSX1NVQ0NFU1NgLCAxLCBNZXRyaWNMb2dnZXJVbml0LkNvdW50KVxuICAgICAgICAgIHJldHVybiByZXNwb25zZVxuICAgICAgICB9LFxuICAgICAgICAoZXJyb3IpID0+IHtcbiAgICAgICAgICBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9HRVRCTE9DS05VTUJFUl9GQUlMVVJFYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudClcbiAgICAgICAgICB0aHJvdyBlcnJvclxuICAgICAgICB9XG4gICAgICApXG4gICAgICAuZmluYWxseSgoKSA9PiBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9HRVRCTE9DS05VTUJFUl9SRVFVRVNURURgLCAxLCBNZXRyaWNMb2dnZXJVbml0LkNvdW50KSlcbiAgfVxuXG4gIG92ZXJyaWRlIGdldEJsb2NrV2l0aFRyYW5zYWN0aW9ucyhcbiAgICBibG9ja0hhc2hPckJsb2NrVGFnOiBCbG9ja1RhZyB8IHN0cmluZyB8IFByb21pc2U8QmxvY2tUYWcgfCBzdHJpbmc+XG4gICk6IFByb21pc2U8QmxvY2tXaXRoVHJhbnNhY3Rpb25zPiB7XG4gICAgcmV0dXJuIHN1cGVyXG4gICAgICAuZ2V0QmxvY2tXaXRoVHJhbnNhY3Rpb25zKGJsb2NrSGFzaE9yQmxvY2tUYWcpXG4gICAgICAudGhlbihcbiAgICAgICAgKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fR0VUQkxPQ0tXSVRIVFJBTlNBQ1RJT05fU1VDQ0VTU2AsIDEsIE1ldHJpY0xvZ2dlclVuaXQuQ291bnQpXG4gICAgICAgICAgcmV0dXJuIHJlc3BvbnNlXG4gICAgICAgIH0sXG4gICAgICAgIChlcnJvcikgPT4ge1xuICAgICAgICAgIG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X0dFVEJMT0NLV0lUSFRSQU5TQUNUSU9OX0ZBSUxVUkVgLCAxLCBNZXRyaWNMb2dnZXJVbml0LkNvdW50KVxuICAgICAgICAgIHRocm93IGVycm9yXG4gICAgICAgIH1cbiAgICAgIClcbiAgICAgIC5maW5hbGx5KCgpID0+XG4gICAgICAgIG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X0dFVEJMT0NLV0lUSFRSQU5TQUNUSU9OX1JFUVVFU1RFRGAsIDEsIE1ldHJpY0xvZ2dlclVuaXQuQ291bnQpXG4gICAgICApXG4gIH1cblxuICBvdmVycmlkZSBnZXRDb2RlKGFkZHJlc3NPck5hbWU6IHN0cmluZyB8IFByb21pc2U8c3RyaW5nPiwgYmxvY2tUYWc/OiBCbG9ja1RhZyB8IFByb21pc2U8QmxvY2tUYWc+KTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICByZXR1cm4gc3VwZXJcbiAgICAgIC5nZXRDb2RlKGFkZHJlc3NPck5hbWUsIGJsb2NrVGFnKVxuICAgICAgLnRoZW4oXG4gICAgICAgIChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgIG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X0dFVENPREVfU1VDQ0VTU2AsIDEsIE1ldHJpY0xvZ2dlclVuaXQuQ291bnQpXG4gICAgICAgICAgcmV0dXJuIHJlc3BvbnNlXG4gICAgICAgIH0sXG4gICAgICAgIChlcnJvcikgPT4ge1xuICAgICAgICAgIG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X0dFVENPREVfRkFJTFVSRWAsIDEsIE1ldHJpY0xvZ2dlclVuaXQuQ291bnQpXG4gICAgICAgICAgdGhyb3cgZXJyb3JcbiAgICAgICAgfVxuICAgICAgKVxuICAgICAgLmZpbmFsbHkoKCkgPT4gbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fR0VUQ09ERV9SRVFVRVNURURgLCAxLCBNZXRyaWNMb2dnZXJVbml0LkNvdW50KSlcbiAgfVxuXG4gIG92ZXJyaWRlIGdldEdhc1ByaWNlKCk6IFByb21pc2U8QmlnTnVtYmVyPiB7XG4gICAgcmV0dXJuIHN1cGVyXG4gICAgICAuZ2V0R2FzUHJpY2UoKVxuICAgICAgLnRoZW4oXG4gICAgICAgIChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgIG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X0dFVEdBU1BSSUNFX1NVQ0NFU1NgLCAxLCBNZXRyaWNMb2dnZXJVbml0LkNvdW50KVxuICAgICAgICAgIHJldHVybiByZXNwb25zZVxuICAgICAgICB9LFxuICAgICAgICAoZXJyb3IpID0+IHtcbiAgICAgICAgICBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9HRVRHQVNQUklDRV9GQUlMVVJFYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudClcbiAgICAgICAgICB0aHJvdyBlcnJvclxuICAgICAgICB9XG4gICAgICApXG4gICAgICAuZmluYWxseSgoKSA9PiBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9HRVRHQVNQUklDRV9SRVFVRVNURURgLCAxLCBNZXRyaWNMb2dnZXJVbml0LkNvdW50KSlcbiAgfVxuXG4gIG92ZXJyaWRlIGdldExvZ3MoZmlsdGVyOiBGaWx0ZXIpOiBQcm9taXNlPEFycmF5PExvZz4+IHtcbiAgICByZXR1cm4gc3VwZXJcbiAgICAgIC5nZXRMb2dzKGZpbHRlcilcbiAgICAgIC50aGVuKFxuICAgICAgICAocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9HRVRMT0dTX1NVQ0NFU1NgLCAxLCBNZXRyaWNMb2dnZXJVbml0LkNvdW50KVxuICAgICAgICAgIHJldHVybiByZXNwb25zZVxuICAgICAgICB9LFxuICAgICAgICAoZXJyb3IpID0+IHtcbiAgICAgICAgICBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9HRVRMT0dTX0ZBSUxVUkVgLCAxLCBNZXRyaWNMb2dnZXJVbml0LkNvdW50KVxuICAgICAgICAgIHRocm93IGVycm9yXG4gICAgICAgIH1cbiAgICAgIClcbiAgICAgIC5maW5hbGx5KCgpID0+IG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X0dFVExPR1NfUkVRVUVTVEVEYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudCkpXG4gIH1cblxuICBvdmVycmlkZSBnZXROZXR3b3JrKCk6IFByb21pc2U8TmV0d29yaz4ge1xuICAgIHJldHVybiBzdXBlclxuICAgICAgLmdldE5ldHdvcmsoKVxuICAgICAgLnRoZW4oXG4gICAgICAgIChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgIG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X0dFVE5FVFdPUktfU1VDQ0VTU2AsIDEsIE1ldHJpY0xvZ2dlclVuaXQuQ291bnQpXG4gICAgICAgICAgcmV0dXJuIHJlc3BvbnNlXG4gICAgICAgIH0sXG4gICAgICAgIChlcnJvcikgPT4ge1xuICAgICAgICAgIG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X0dFVE5FVFdPUktfRkFJTFVSRWAsIDEsIE1ldHJpY0xvZ2dlclVuaXQuQ291bnQpXG4gICAgICAgICAgdGhyb3cgZXJyb3JcbiAgICAgICAgfVxuICAgICAgKVxuICAgICAgLmZpbmFsbHkoKCkgPT4gbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fR0VUTkVUV09SS19SRVFVRVNURURgLCAxLCBNZXRyaWNMb2dnZXJVbml0LkNvdW50KSlcbiAgfVxuXG4gIG92ZXJyaWRlIGdldFN0b3JhZ2VBdChcbiAgICBhZGRyZXNzT3JOYW1lOiBzdHJpbmcgfCBQcm9taXNlPHN0cmluZz4sXG4gICAgcG9zaXRpb246IEJpZ051bWJlcmlzaCB8IFByb21pc2U8QmlnTnVtYmVyaXNoPixcbiAgICBibG9ja1RhZz86IEJsb2NrVGFnIHwgUHJvbWlzZTxCbG9ja1RhZz5cbiAgKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICByZXR1cm4gc3VwZXJcbiAgICAgIC5nZXRTdG9yYWdlQXQoYWRkcmVzc09yTmFtZSwgcG9zaXRpb24sIGJsb2NrVGFnKVxuICAgICAgLnRoZW4oXG4gICAgICAgIChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgIG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X0dFVFNUT1JBR0VBVF9TVUNDRVNTYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudClcbiAgICAgICAgICByZXR1cm4gcmVzcG9uc2VcbiAgICAgICAgfSxcbiAgICAgICAgKGVycm9yKSA9PiB7XG4gICAgICAgICAgbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fR0VUU1RPUkFHRUFUX0ZBSUxVUkVgLCAxLCBNZXRyaWNMb2dnZXJVbml0LkNvdW50KVxuICAgICAgICAgIHRocm93IGVycm9yXG4gICAgICAgIH1cbiAgICAgIClcbiAgICAgIC5maW5hbGx5KCgpID0+IG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X0dFVFNUT1JBR0VBVF9SRVFVRVNURURgLCAxLCBNZXRyaWNMb2dnZXJVbml0LkNvdW50KSlcbiAgfVxuXG4gIG92ZXJyaWRlIGdldFRyYW5zYWN0aW9uKHRyYW5zYWN0aW9uSGFzaDogc3RyaW5nKTogUHJvbWlzZTxUcmFuc2FjdGlvblJlc3BvbnNlPiB7XG4gICAgcmV0dXJuIHN1cGVyXG4gICAgICAuZ2V0VHJhbnNhY3Rpb24odHJhbnNhY3Rpb25IYXNoKVxuICAgICAgLnRoZW4oXG4gICAgICAgIChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgIG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X0dFVFRSQU5TQUNUSU9OX1NVQ0NFU1NgLCAxLCBNZXRyaWNMb2dnZXJVbml0LkNvdW50KVxuICAgICAgICAgIHJldHVybiByZXNwb25zZVxuICAgICAgICB9LFxuICAgICAgICAoZXJyb3IpID0+IHtcbiAgICAgICAgICBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9HRVRUUkFOU0FDVElPTl9GQUlMVVJFYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudClcbiAgICAgICAgICB0aHJvdyBlcnJvclxuICAgICAgICB9XG4gICAgICApXG4gICAgICAuZmluYWxseSgoKSA9PiBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9HRVRUUkFOU0FDVElPTl9SRVFVRVNURURgLCAxLCBNZXRyaWNMb2dnZXJVbml0LkNvdW50KSlcbiAgfVxuXG4gIG92ZXJyaWRlIGdldFRyYW5zYWN0aW9uQ291bnQoXG4gICAgYWRkcmVzc09yTmFtZTogc3RyaW5nIHwgUHJvbWlzZTxzdHJpbmc+LFxuICAgIGJsb2NrVGFnPzogQmxvY2tUYWcgfCBQcm9taXNlPEJsb2NrVGFnPlxuICApOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIHJldHVybiBzdXBlclxuICAgICAgLmdldFRyYW5zYWN0aW9uQ291bnQoYWRkcmVzc09yTmFtZSwgYmxvY2tUYWcpXG4gICAgICAudGhlbihcbiAgICAgICAgKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fR0VUVFJBTlNBQ1RJT05DT1VOVF9TVUNDRVNTYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudClcbiAgICAgICAgICByZXR1cm4gcmVzcG9uc2VcbiAgICAgICAgfSxcbiAgICAgICAgKGVycm9yKSA9PiB7XG4gICAgICAgICAgbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fR0VUVFJBTlNBQ1RJT05DT1VOVF9GQUlMVVJFYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudClcbiAgICAgICAgICB0aHJvdyBlcnJvclxuICAgICAgICB9XG4gICAgICApXG4gICAgICAuZmluYWxseSgoKSA9PiBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9HRVRUUkFOU0FDVElPTkNPVU5UX1JFUVVFU1RFRGAsIDEsIE1ldHJpY0xvZ2dlclVuaXQuQ291bnQpKVxuICB9XG5cbiAgb3ZlcnJpZGUgZ2V0VHJhbnNhY3Rpb25SZWNlaXB0KHRyYW5zYWN0aW9uSGFzaDogc3RyaW5nKTogUHJvbWlzZTxUcmFuc2FjdGlvblJlY2VpcHQ+IHtcbiAgICByZXR1cm4gc3VwZXJcbiAgICAgIC5nZXRUcmFuc2FjdGlvblJlY2VpcHQodHJhbnNhY3Rpb25IYXNoKVxuICAgICAgLnRoZW4oXG4gICAgICAgIChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgIG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X0dFVFRSQU5TQUNUSU9OUkVDRUlQVF9TVUNDRVNTYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudClcbiAgICAgICAgICByZXR1cm4gcmVzcG9uc2VcbiAgICAgICAgfSxcbiAgICAgICAgKGVycm9yKSA9PiB7XG4gICAgICAgICAgbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fR0VUVFJBTlNBQ1RJT05SRUNFSVBUX0ZBSUxVUkVgLCAxLCBNZXRyaWNMb2dnZXJVbml0LkNvdW50KVxuICAgICAgICAgIHRocm93IGVycm9yXG4gICAgICAgIH1cbiAgICAgIClcbiAgICAgIC5maW5hbGx5KCgpID0+XG4gICAgICAgIG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X0dFVFRSQU5TQUNUSU9OUkVDRUlQVF9SRVFVRVNURURgLCAxLCBNZXRyaWNMb2dnZXJVbml0LkNvdW50KVxuICAgICAgKVxuICB9XG5cbiAgb3ZlcnJpZGUgbG9va3VwQWRkcmVzcyhhZGRyZXNzOiBzdHJpbmcgfCBQcm9taXNlPHN0cmluZz4pOiBQcm9taXNlPHN0cmluZyB8IG51bGw+IHtcbiAgICByZXR1cm4gc3VwZXJcbiAgICAgIC5sb29rdXBBZGRyZXNzKGFkZHJlc3MpXG4gICAgICAudGhlbihcbiAgICAgICAgKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fTE9PS1VQQUREUkVTU19TVUNDRVNTYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudClcbiAgICAgICAgICByZXR1cm4gcmVzcG9uc2VcbiAgICAgICAgfSxcbiAgICAgICAgKGVycm9yKSA9PiB7XG4gICAgICAgICAgbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fTE9PS1VQQUREUkVTU19GQUlMVVJFYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudClcbiAgICAgICAgICB0aHJvdyBlcnJvclxuICAgICAgICB9XG4gICAgICApXG4gICAgICAuZmluYWxseSgoKSA9PiBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9MT09LVVBBRERSRVNTX1JFUVVFU1RFRGAsIDEsIE1ldHJpY0xvZ2dlclVuaXQuQ291bnQpKVxuICB9XG5cbiAgb3ZlcnJpZGUgcmVzb2x2ZU5hbWUobmFtZTogc3RyaW5nIHwgUHJvbWlzZTxzdHJpbmc+KTogUHJvbWlzZTxzdHJpbmcgfCBudWxsPiB7XG4gICAgcmV0dXJuIHN1cGVyXG4gICAgICAucmVzb2x2ZU5hbWUobmFtZSlcbiAgICAgIC50aGVuKFxuICAgICAgICAocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9SRVNPTFZFTkFNRV9TVUNDRVNTYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudClcbiAgICAgICAgICByZXR1cm4gcmVzcG9uc2VcbiAgICAgICAgfSxcbiAgICAgICAgKGVycm9yKSA9PiB7XG4gICAgICAgICAgbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fUkVTT0xWRU5BTUVfRkFJTFVSRWAsIDEsIE1ldHJpY0xvZ2dlclVuaXQuQ291bnQpXG4gICAgICAgICAgdGhyb3cgZXJyb3JcbiAgICAgICAgfVxuICAgICAgKVxuICAgICAgLmZpbmFsbHkoKCkgPT4gbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fUkVTT0xWRU5BTUVfUkVRVUVTVEVEYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudCkpXG4gIH1cblxuICBvdmVycmlkZSBzZW5kVHJhbnNhY3Rpb24oc2lnbmVkVHJhbnNhY3Rpb246IHN0cmluZyB8IFByb21pc2U8c3RyaW5nPik6IFByb21pc2U8VHJhbnNhY3Rpb25SZXNwb25zZT4ge1xuICAgIHJldHVybiBzdXBlclxuICAgICAgLnNlbmRUcmFuc2FjdGlvbihzaWduZWRUcmFuc2FjdGlvbilcbiAgICAgIC50aGVuKFxuICAgICAgICAocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9TRU5EVFJBTlNBQ1RJT05fU1VDQ0VTU2AsIDEsIE1ldHJpY0xvZ2dlclVuaXQuQ291bnQpXG4gICAgICAgICAgcmV0dXJuIHJlc3BvbnNlXG4gICAgICAgIH0sXG4gICAgICAgIChlcnJvcikgPT4ge1xuICAgICAgICAgIG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X1NFTkRUUkFOU0FDVElPTl9GQUlMVVJFYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudClcbiAgICAgICAgICB0aHJvdyBlcnJvclxuICAgICAgICB9XG4gICAgICApXG4gICAgICAuZmluYWxseSgoKSA9PiBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9TRU5EVFJBTlNBQ1RJT05fUkVRVUVTVEVEYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudCkpXG4gIH1cblxuICBvdmVycmlkZSB3YWl0Rm9yVHJhbnNhY3Rpb24oXG4gICAgdHJhbnNhY3Rpb25IYXNoOiBzdHJpbmcsXG4gICAgY29uZmlybWF0aW9ucz86IG51bWJlcixcbiAgICB0aW1lb3V0PzogbnVtYmVyXG4gICk6IFByb21pc2U8VHJhbnNhY3Rpb25SZWNlaXB0PiB7XG4gICAgcmV0dXJuIHN1cGVyXG4gICAgICAud2FpdEZvclRyYW5zYWN0aW9uKHRyYW5zYWN0aW9uSGFzaCwgY29uZmlybWF0aW9ucywgdGltZW91dClcbiAgICAgIC50aGVuKFxuICAgICAgICAocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9XQUlURk9SVFJBTlNBQ1RJT05fU1VDQ0VTU2AsIDEsIE1ldHJpY0xvZ2dlclVuaXQuQ291bnQpXG4gICAgICAgICAgcmV0dXJuIHJlc3BvbnNlXG4gICAgICAgIH0sXG4gICAgICAgIChlcnJvcikgPT4ge1xuICAgICAgICAgIG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X1dBSVRGT1JUUkFOU0FDVElPTl9GQUlMVVJFYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudClcbiAgICAgICAgICB0aHJvdyBlcnJvclxuICAgICAgICB9XG4gICAgICApXG4gICAgICAuZmluYWxseSgoKSA9PiBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9XQUlURk9SVFJBTlNBQ1RJT05fUkVRVUVTVEVEYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudCkpXG4gIH1cbn1cbiJdfQ==