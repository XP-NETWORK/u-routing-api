import { TradeType } from '@uniswap/sdk-core';
import { ID_TO_NETWORK_NAME } from '@uniswap/smart-order-router';
import _ from 'lodash';
import { PAIRS_TO_TRACK } from '../handlers/quote/util/pairs-to-track';
export class QuoteAmountsWidgetsFactory {
    constructor(namespace, region) {
        this.region = region;
        this.namespace = namespace;
    }
    generateWidgets() {
        const pairsToTrackEntries = Array.from(PAIRS_TO_TRACK.entries());
        const widgets = _.flatMap(pairsToTrackEntries, ([chainId, pairsByTradeType]) => {
            return this.generateChartWidgetsFromPairsByTradeType(chainId, pairsByTradeType);
        });
        return widgets;
    }
    generateChartWidgetsFromPairsByTradeType(chainId, pairsByTradeType) {
        const pairsByTradeTypeEntries = Array.from(pairsByTradeType.entries());
        const widgets = _.flatMap(pairsByTradeTypeEntries, ([tradeType, pairs]) => this.generateChartWidgetsFromPairs(chainId, tradeType, pairs));
        return widgets;
    }
    generateChartWidgetsFromPairs(chainId, tradeType, pairs) {
        return _.flatMap(pairs, (pair) => this.generateChartWidgetsFromPair(chainId, tradeType, pair));
    }
    generateChartWidgetsFromPair(chainId, tradeType, pair) {
        const tradeTypeLabel = this.tradeTypeToString(tradeType);
        const widgets = [
            {
                type: 'text',
                width: 24,
                height: 2,
                properties: {
                    markdown: `# ${ID_TO_NETWORK_NAME(chainId)} - ChainId: ${chainId}\n## ${pair} - ${tradeTypeLabel}`,
                },
            },
            {
                type: 'metric',
                width: 24,
                height: 6,
                properties: {
                    view: 'timeSeries',
                    stacked: false,
                    metrics: [
                        [
                            this.namespace,
                            `GET_QUOTE_AMOUNT_${pair}_${tradeTypeLabel.toUpperCase()}_CHAIN_${chainId}`,
                            'Service',
                            'RoutingAPI',
                            { label: `${pair}/${tradeTypeLabel.toUpperCase()} Quotes` },
                        ],
                    ],
                    region: this.region,
                    title: `Number of requested quotes ${pair}/${tradeTypeLabel}`,
                    period: 300,
                    stat: 'SampleCount',
                },
            },
            {
                type: 'metric',
                width: 24,
                height: 9,
                properties: {
                    view: 'timeSeries',
                    stacked: true,
                    metrics: [
                        [
                            this.namespace,
                            `GET_QUOTE_AMOUNT_${pair}_${tradeTypeLabel.toUpperCase()}_CHAIN_${chainId}`,
                            'Service',
                            'RoutingAPI',
                            this.generateStatWithLabel(0, 0.001, pair, tradeType),
                        ],
                        ['...', this.generateStatWithLabel(0.001, 0.005, pair, tradeType)],
                        ['...', this.generateStatWithLabel(0.005, 0.01, pair, tradeType)],
                        ['...', this.generateStatWithLabel(0.01, 0.05, pair, tradeType)],
                        ['...', this.generateStatWithLabel(0.05, 0.1, pair, tradeType)],
                        ['...', this.generateStatWithLabel(0.1, 0.5, pair, tradeType)],
                        ['...', this.generateStatWithLabel(0.5, 1, pair, tradeType)],
                        ['...', this.generateStatWithLabel(1, 5, pair, tradeType)],
                        ['...', this.generateStatWithLabel(5, 10, pair, tradeType)],
                        ['...', this.generateStatWithLabel(10, 50, pair, tradeType)],
                        ['...', this.generateStatWithLabel(50, 100, pair, tradeType)],
                        ['...', this.generateStatWithLabel(100, 500, pair, tradeType)],
                        ['...', this.generateStatWithLabel(500, 1000, pair, tradeType)],
                        ['...', this.generateStatWithLabel(1000, 5000, pair, tradeType)],
                        ['...', this.generateStatWithLabel(5000, 10000, pair, tradeType)],
                        ['...', this.generateStatWithLabel(10000, 50000, pair, tradeType)],
                        ['...', this.generateStatWithLabel(50000, 100000, pair, tradeType)],
                        ['...', this.generateStatWithLabel(100000, 500000, pair, tradeType)],
                        ['...', this.generateStatWithLabel(500000, 1000000, pair, tradeType)],
                        ['...', this.generateStatWithLabel(1000000, -1, pair, tradeType)],
                    ],
                    region: this.region,
                    title: `Distribution of quotes ${pair}/${tradeTypeLabel}`,
                    period: 300,
                },
            },
        ];
        return widgets;
    }
    tradeTypeToString(tradeType) {
        if (tradeType == TradeType.EXACT_INPUT) {
            return 'ExactIn';
        }
        else {
            return 'ExactOut';
        }
    }
    generateStatWithLabel(min, max, pair, tradeType) {
        const tokens = pair.split('/');
        const maxNormalized = max > 0 ? max.toString() : '';
        switch (tradeType) {
            case TradeType.EXACT_INPUT:
                return {
                    stat: `PR(${min}:${maxNormalized})`,
                    label: `${min} to ${max} ${tokens[0]}`,
                };
            case TradeType.EXACT_OUTPUT:
                return {
                    stat: `PR(${min}:${maxNormalized})`,
                    label: `${min} to ${max} ${tokens[1]}`,
                };
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicXVvdGUtYW1vdW50cy13aWRnZXRzLWZhY3RvcnkuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9saWIvZGFzaGJvYXJkcy9xdW90ZS1hbW91bnRzLXdpZGdldHMtZmFjdG9yeS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQVcsU0FBUyxFQUFFLE1BQU0sbUJBQW1CLENBQUE7QUFDdEQsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sNkJBQTZCLENBQUE7QUFDaEUsT0FBTyxDQUFDLE1BQU0sUUFBUSxDQUFBO0FBQ3RCLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSx1Q0FBdUMsQ0FBQTtBQUl0RSxNQUFNLE9BQU8sMEJBQTBCO0lBSXJDLFlBQVksU0FBaUIsRUFBRSxNQUFjO1FBQzNDLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFBO1FBQ3BCLElBQUksQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFBO0lBQzVCLENBQUM7SUFFRCxlQUFlO1FBQ2IsTUFBTSxtQkFBbUIsR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFBO1FBQ2hFLE1BQU0sT0FBTyxHQUFhLENBQUMsQ0FBQyxPQUFPLENBQUMsbUJBQW1CLEVBQUUsQ0FBQyxDQUFDLE9BQU8sRUFBRSxnQkFBZ0IsQ0FBQyxFQUFFLEVBQUU7WUFDdkYsT0FBTyxJQUFJLENBQUMsd0NBQXdDLENBQUMsT0FBTyxFQUFFLGdCQUFnQixDQUFDLENBQUE7UUFDakYsQ0FBQyxDQUFDLENBQUE7UUFFRixPQUFPLE9BQU8sQ0FBQTtJQUNoQixDQUFDO0lBRU8sd0NBQXdDLENBQzlDLE9BQWdCLEVBQ2hCLGdCQUEwQztRQUUxQyxNQUFNLHVCQUF1QixHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQTtRQUV0RSxNQUFNLE9BQU8sR0FBRyxDQUFDLENBQUMsT0FBTyxDQUFD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QUksQ0FBQyxxQkFBcUIsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxTQUFTLENBQUMsQ0FBQzt3QkFDOUQsQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLHFCQUFxQixDQUFDLEdBQUcsRUFBRSxDQUFDLEVBQUUsSUFBSSxFQUFFLFNBQVMsQ0FBQyxDQUFDO3dCQUM1RCxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMscUJBQXFCLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxJQUFJLEVBQUUsU0FBUyxDQUFDLENBQUM7d0JBQzFELENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLEVBQUUsRUFBRSxFQUFFLElBQUksRUFBRSxTQUFTLENBQUMsQ0FBQzt3QkFDM0QsQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLHFCQUFxQixDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsSUFBSSxFQUFFLFNBQVMsQ0FBQyxDQUFDO3dCQUM1RCxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMscUJBQXFCLENBQUMsRUFBRSxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsU0FBUyxDQUFDLENBQUM7d0JBQzdELENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxTQUFTLENBQUMsQ0FBQzt3QkFDOUQsQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLHFCQUFxQixDQUFDLEdBQUcsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLFNBQVMsQ0FBQyxDQUFDO3dCQUMvRCxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMscUJBQXFCLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsU0FBUyxDQUFDLENBQUM7d0JBQ2hFLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxJQUFJLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxTQUFTLENBQUMsQ0FBQzt3QkFDakUsQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLHFCQUFxQixDQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLFNBQVMsQ0FBQyxDQUFDO3dCQUNsRSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMscUJBQXFCLENBQUMsS0FBSyxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsU0FBUyxDQUFDLENBQUM7d0JBQ25FLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxNQUFNLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxTQUFTLENBQUMsQ0FBQzt3QkFDcEUsQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLHFCQUFxQixDQUFDLE1BQU0sRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLFNBQVMsQ0FBQyxDQUFDO3dCQUNyRSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMscUJBQXFCLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxTQUFTLENBQUMsQ0FBQztxQkFDbEU7b0JBQ0QsTUFBTSxFQUFFLElBQUksQ0FBQyxNQUFNO29CQUNuQixLQUFLLEVBQUUsMEJBQTBCLElBQUksSUFBSSxjQUFjLEVBQUU7b0JBQ3pELE1BQU0sRUFBRSxHQUFHO2lCQUNaO2FBQ0Y7U0FDRixDQUFBO1FBRUQsT0FBTyxPQUFPLENBQUE7SUFDaEIsQ0FBQztJQUVPLGlCQUFpQixDQUFDLFNBQW9CO1FBQzVDLElBQUksU0FBUyxJQUFJLFNBQVMsQ0FBQyxXQUFXLEVBQUU7WUFDdEMsT0FBTyxTQUFTLENBQUE7U0FDakI7YUFBTTtZQUNMLE9BQU8sVUFBVSxDQUFBO1NBQ2xCO0lBQ0gsQ0FBQztJQUVPLHFCQUFxQixDQUMzQixHQUFXLEVBQ1gsR0FBVyxFQUNYLElBQVksRUFDWixTQUFvQjtRQUVwQixNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFBO1FBQzlCLE1BQU0sYUFBYSxHQUFHLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFBO1FBRW5ELFFBQVEsU0FBUyxFQUFFO1lBQ2pCLEtBQUssU0FBUyxDQUFDLFdBQVc7Z0JBQ3hCLE9BQU87b0JBQ0wsSUFBSSxFQUFFLE1BQU0sR0FBRyxJQUFJLGFBQWEsR0FBRztvQkFDbkMsS0FBSyxFQUFFLEdBQUcsR0FBRyxPQUFPLEdBQUcsSUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUU7aUJBQ3ZDLENBQUE7WUFDSCxLQUFLLFNBQVMsQ0FBQyxZQUFZO2dCQUN6QixPQUFPO29CQUNMLElBQUksRUFBRSxNQUFNLEdBQUcsSUFBSSxhQUFhLEdBQUc7b0JBQ25DLEtBQUssRUFBRSxHQUFHLEdBQUcsT0FBTyxHQUFHLElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFO2lCQUN2QyxDQUFBO1NBQ0o7SUFDSCxDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDaGFpbklkLCBUcmFkZVR5cGUgfSBmcm9tICdAdW5pc3dhcC9zZGstY29yZSdcbmltcG9ydCB7IElEX1RPX05FVFdPUktfTkFNRSB9IGZyb20gJ0B1bmlzd2FwL3NtYXJ0LW9yZGVyLXJvdXRlcidcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCdcbmltcG9ydCB7IFBBSVJTX1RPX1RSQUNLIH0gZnJvbSAnLi4vaGFuZGxlcnMvcXVvdGUvdXRpbC9wYWlycy10by10cmFjaydcbmltcG9ydCB7IFdpZGdldCB9IGZyb20gJy4vY29yZS9tb2RlbC93aWRnZXQnXG5pbXBvcnQgeyBXaWRnZXRzRmFjdG9yeSB9IGZyb20gJy4vY29yZS93aWRnZXRzLWZhY3RvcnknXG5cbmV4cG9ydCBjbGFzcyBRdW90ZUFtb3VudHNXaWRnZXRzRmFjdG9yeSBpbXBsZW1lbnRzIFdpZGdldHNGYWN0b3J5IHtcbiAgcmVnaW9uOiBzdHJpbmdcbiAgbmFtZXNwYWNlOiBzdHJpbmdcblxuICBjb25zdHJ1Y3RvcihuYW1lc3BhY2U6IHN0cmluZywgcmVnaW9uOiBzdHJpbmcpIHtcbiAgICB0aGlzLnJlZ2lvbiA9IHJlZ2lvblxuICAgIHRoaXMubmFtZXNwYWNlID0gbmFtZXNwYWNlXG4gIH1cblxuICBnZW5lcmF0ZVdpZGdldHMoKTogV2lkZ2V0W10ge1xuICAgIGNvbnN0IHBhaXJzVG9UcmFja0VudHJpZXMgPSBBcnJheS5mcm9tKFBBSVJTX1RPX1RSQUNLLmVudHJpZXMoKSlcbiAgICBjb25zdCB3aWRnZXRzOiBXaWRnZXRbXSA9IF8uZmxhdE1hcChwYWlyc1RvVHJhY2tFbnRyaWVzLCAoW2NoYWluSWQsIHBhaXJzQnlUcmFkZVR5cGVdKSA9PiB7XG4gICAgICByZXR1cm4gdGhpcy5nZW5lcmF0ZUNoYXJ0V2lkZ2V0c0Zyb21QYWlyc0J5VHJhZGVUeXBlKGNoYWluSWQsIHBhaXJzQnlUcmFkZVR5cGUpXG4gICAgfSlcblxuICAgIHJldHVybiB3aWRnZXRzXG4gIH1cblxuICBwcml2YXRlIGdlbmVyYXRlQ2hhcnRXaWRnZXRzRnJvbVBhaXJzQnlUcmFkZVR5cGUoXG4gICAgY2hhaW5JZDogQ2hhaW5JZCxcbiAgICBwYWlyc0J5VHJhZGVUeXBlOiBNYXA8VHJhZGVUeXBlLCBzdHJpbmdbXT5cbiAgKTogV2lkZ2V0W10ge1xuICAgIGNvbnN0IHBhaXJzQnlUcmFkZVR5cGVFbnRyaWVzID0gQXJyYXkuZnJvbShwYWlyc0J5VHJhZGVUeXBlLmVudHJpZXMoKSlcblxuICAgIGNvbnN0IHdpZGdldHMgPSBfLmZsYXRNYXAocGFpcnNCeVRyYWRlVHlwZUVudHJpZXMsIChbdHJhZGVUeXBlLCBwYWlyc106IFtUcmFkZVR5cGUsIHN0cmluZ1tdXSkgPT5cbiAgICAgIHRoaXMuZ2VuZXJhdGVDaGFydFdpZGdldHNGcm9tUGFpcnMoY2hhaW5JZCwgdHJhZGVUeXBlLCBwYWlycylcbiAgICApXG5cbiAgICByZXR1cm4gd2lkZ2V0c1xuICB9XG5cbiAgcHJpdmF0ZSBnZW5lcmF0ZUNoYXJ0V2lkZ2V0c0Zyb21QYWlycyhjaGFpbklkOiBDaGFpbklkLCB0cmFkZVR5cGU6IFRyYWRlVHlwZSwgcGFpcnM6IHN0cmluZ1tdKTogV2lkZ2V0W10ge1xuICAgIHJldHVybiBfLmZsYXRNYXAocGFpcnMsIChwYWlyOiBzdHJpbmcpID0+IHRoaXMuZ2VuZXJhdGVDaGFydFdpZGdldHNGcm9tUGFpcihjaGFpbklkLCB0cmFkZVR5cGUsIHBhaXIpKVxuICB9XG5cbiAgcHJpdmF0ZSBnZW5lcmF0ZUNoYXJ0V2lkZ2V0c0Zyb21QYWlyKGNoYWluSWQ6IENoYWluSWQsIHRyYWRlVHlwZTogVHJhZGVUeXBlLCBwYWlyOiBzdHJpbmcpOiBXaWRnZXRbXSB7XG4gICAgY29uc3QgdHJhZGVUeXBlTGFiZWwgPSB0aGlzLnRyYWRlVHlwZVRvU3RyaW5nKHRyYWRlVHlwZSlcbiAgICBjb25zdCB3aWRnZXRzOiBXaWRnZXRbXSA9IFtcbiAgICAgIHtcbiAgICAgICAgdHlwZTogJ3RleHQnLFxuICAgICAgICB3aWR0aDogMjQsXG4gICAgICAgIGhlaWdodDogMixcbiAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgIG1hcmtkb3duOiBgIyAke0lEX1RPX05FVFdPUktfTkFNRShjaGFpbklkKX0gLSBDaGFpbklkOiAke2NoYWluSWR9XFxuIyMgJHtwYWlyfSAtICR7dHJhZGVUeXBlTGFiZWx9YCxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHR5cGU6ICdtZXRyaWMnLFxuICAgICAgICB3aWR0aDogMjQsXG4gICAgICAgIGhlaWdodDogNixcbiAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgIHZpZXc6ICd0aW1lU2VyaWVzJyxcbiAgICAgICAgICBzdGFja2VkOiBmYWxzZSxcbiAgICAgICAgICBtZXRyaWNzOiBbXG4gICAgICAgICAgICBbXG4gICAgICAgICAgICAgIHRoaXMubmFtZXNwYWNlLFxuICAgICAgICAgICAgICBgR0VUX1FVT1RFX0FNT1VOVF8ke3BhaXJ9XyR7dHJhZGVUeXBlTGFiZWwudG9VcHBlckNhc2UoKX1fQ0hBSU5fJHtjaGFpbklkfWAsXG4gICAgICAgICAgICAgICdTZXJ2aWNlJyxcbiAgICAgICAgICAgICAgJ1JvdXRpbmdBUEknLFxuICAgICAgICAgICAgICB7IGxhYmVsOiBgJHtwYWlyfS8ke3RyYWRlVHlwZUxhYmVsLnRvVXBwZXJDYXNlKCl9IFF1b3Rlc2AgfSxcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgXSxcbiAgICAgICAgICByZWdpb246IHRoaXMucmVnaW9uLFxuICAgICAgICAgIHRpdGxlOiBgTnVtYmVyIG9mIHJlcXVlc3RlZCBxdW90ZXMgJHtwYWlyfS8ke3RyYWRlVHlwZUxhYmVsfWAsXG4gICAgICAgICAgcGVyaW9kOiAzMDAsXG4gICAgICAgICAgc3RhdDogJ1NhbXBsZUNvdW50JyxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHR5cGU6ICdtZXRyaWMnLFxuICAgICAgICB3aWR0aDogMjQsXG4gICAgICAgIGhlaWdodDogOSxcbiAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgIHZpZXc6ICd0aW1lU2VyaWVzJyxcbiAgICAgICAgICBzdGFja2VkOiB0cnVlLFxuICAgICAgICAgIG1ldHJpY3M6IFtcbiAgICAgICAgICAgIFtcbiAgICAgICAgICAgICAgdGhpcy5uYW1lc3BhY2UsXG4gICAgICAgICAgICAgIGBHRVRfUVVPVEVfQU1PVU5UXyR7cGFpcn1fJHt0cmFkZVR5cGVMYWJlbC50b1VwcGVyQ2FzZSgpfV9DSEFJTl8ke2NoYWluSWR9YCxcbiAgICAgICAgICAgICAgJ1NlcnZpY2UnLFxuICAgICAgICAgICAgICAnUm91dGluZ0FQSScsXG4gICAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVTdGF0V2l0aExhYmVsKDAsIDAuMDAxLCBwYWlyLCB0cmFkZVR5cGUpLFxuICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIFsnLi4uJywgdGhpcy5nZW5lcmF0ZVN0YXRXaXRoTGFiZWwoMC4wMDEsIDAuMDA1LCBwYWlyLCB0cmFkZVR5cGUpXSxcbiAgICAgICAgICAgIFsnLi4uJywgdGhpcy5nZW5lcmF0ZVN0YXRXaXRoTGFiZWwoMC4wMDUsIDAuMDEsIHBhaXIsIHRyYWRlVHlwZSldLFxuICAgICAgICAgICAgWycuLi4nLCB0aGlzLmdlbmVyYXRlU3RhdFdpdGhMYWJlbCgwLjAxLCAwLjA1LCBwYWlyLCB0cmFkZVR5cGUpXSxcbiAgICAgICAgICAgIFsnLi4uJywgdGhpcy5nZW5lcmF0ZVN0YXRXaXRoTGFiZWwoMC4wNSwgMC4xLCBwYWlyLCB0cmFkZVR5cGUpXSxcbiAgICAgICAgICAgIFsnLi4uJywgdGhpcy5nZW5lcmF0ZVN0YXRXaXRoTGFiZWwoMC4xLCAwLjUsIHBhaXIsIHRyYWRlVHlwZSldLFxuICAgICAgICAgICAgWycuLi4nLCB0aGlzLmdlbmVyYXRlU3RhdFdpdGhMYWJlbCgwLjUsIDEsIHBhaXIsIHRyYWRlVHlwZSldLFxuICAgICAgICAgICAgWycuLi4nLCB0aGlzLmdlbmVyYXRlU3RhdFdpdGhMYWJlbCgxLCA1LCBwYWlyLCB0cmFkZVR5cGUpXSxcbiAgICAgICAgICAgIFsnLi4uJywgdGhpcy5nZW5lcmF0ZVN0YXRXaXRoTGFiZWwoNSwgMTAsIHBhaXIsIHRyYWRlVHlwZSldLFxuICAgICAgICAgICAgWycuLi4nLCB0aGlzLmdlbmVyYXRlU3RhdFdpdGhMYWJlbCgxMCwgNTAsIHBhaXIsIHRyYWRlVHlwZSldLFxuICAgICAgICAgICAgWycuLi4nLCB0aGlzLmdlbmVyYXRlU3RhdFdpdGhMYWJlbCg1MCwgMTAwLCBwYWlyLCB0cmFkZVR5cGUpXSxcbiAgICAgICAgICAgIFsnLi4uJywgdGhpcy5nZW5lcmF0ZVN0YXRXaXRoTGFiZWwoMTAwLCA1MDAsIHBhaXIsIHRyYWRlVHlwZSldLFxuICAgICAgICAgICAgWycuLi4nLCB0aGlzLmdlbmVyYXRlU3RhdFdpdGhMYWJlbCg1MDAsIDEwMDAsIHBhaXIsIHRyYWRlVHlwZSldLFxuICAgICAgICAgICAgWycuLi4nLCB0aGlzLmdlbmVyYXRlU3RhdFdpdGhMYWJlbCgxMDAwLCA1MDAwLCBwYWlyLCB0cmFkZVR5cGUpXSxcbiAgICAgICAgICAgIFsnLi4uJywgdGhpcy5nZW5lcmF0ZVN0YXRXaXRoTGFiZWwoNTAwMCwgMTAwMDAsIHBhaXIsIHRyYWRlVHlwZSldLFxuICAgICAgICAgICAgWycuLi4nLCB0aGlzLmdlbmVyYXRlU3RhdFdpdGhMYWJlbCgxMDAwMCwgNTAwMDAsIHBhaXIsIHRyYWRlVHlwZSldLFxuICAgICAgICAgICAgWycuLi4nLCB0aGlzLmdlbmVyYXRlU3RhdFdpdGhMYWJlbCg1MDAwMCwgMTAwMDAwLCBwYWlyLCB0cmFkZVR5cGUpXSxcbiAgICAgICAgICAgIFsnLi4uJywgdGhpcy5nZW5lcmF0ZVN0YXRXaXRoTGFiZWwoMTAwMDAwLCA1MDAwMDAsIHBhaXIsIHRyYWRlVHlwZSldLFxuICAgICAgICAgICAgWycuLi4nLCB0aGlzLmdlbmVyYXRlU3RhdFdpdGhMYWJlbCg1MDAwMDAsIDEwMDAwMDAsIHBhaXIsIHRyYWRlVHlwZSldLFxuICAgICAgICAgICAgWycuLi4nLCB0aGlzLmdlbmVyYXRlU3RhdFdpdGhMYWJlbCgxMDAwMDAwLCAtMSwgcGFpciwgdHJhZGVUeXBlKV0sXG4gICAgICAgICAgXSxcbiAgICAgICAgICByZWdpb246IHRoaXMucmVnaW9uLFxuICAgICAgICAgIHRpdGxlOiBgRGlzdHJpYnV0aW9uIG9mIHF1b3RlcyAke3BhaXJ9LyR7dHJhZGVUeXBlTGFiZWx9YCxcbiAgICAgICAgICBwZXJpb2Q6IDMwMCxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgXVxuXG4gICAgcmV0dXJuIHdpZGdldHNcbiAgfVxuXG4gIHByaXZhdGUgdHJhZGVUeXBlVG9TdHJpbmcodHJhZGVUeXBlOiBUcmFkZVR5cGUpIHtcbiAgICBpZiAodHJhZGVUeXBlID09IFRyYWRlVHlwZS5FWEFDVF9JTlBVVCkge1xuICAgICAgcmV0dXJuICdFeGFjdEluJ1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gJ0V4YWN0T3V0J1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZ2VuZXJhdGVTdGF0V2l0aExhYmVsKFxuICAgIG1pbjogbnVtYmVyLFxuICAgIG1heDogbnVtYmVyLFxuICAgIHBhaXI6IHN0cmluZyxcbiAgICB0cmFkZVR5cGU6IFRyYWRlVHlwZVxuICApOiB7IHN0YXQ6IHN0cmluZzsgbGFiZWw6IHN0cmluZyB9IHtcbiAgICBjb25zdCB0b2tlbnMgPSBwYWlyLnNwbGl0KCcvJylcbiAgICBjb25zdCBtYXhOb3JtYWxpemVkID0gbWF4ID4gMCA/IG1heC50b1N0cmluZygpIDogJydcblxuICAgIHN3aXRjaCAodHJhZGVUeXBlKSB7XG4gICAgICBjYXNlIFRyYWRlVHlwZS5FWEFDVF9JTlBVVDpcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzdGF0OiBgUFIoJHttaW59OiR7bWF4Tm9ybWFsaXplZH0pYCxcbiAgICAgICAgICBsYWJlbDogYCR7bWlufSB0byAke21heH0gJHt0b2tlbnNbMF19YCxcbiAgICAgICAgfVxuICAgICAgY2FzZSBUcmFkZVR5cGUuRVhBQ1RfT1VUUFVUOlxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHN0YXQ6IGBQUigke21pbn06JHttYXhOb3JtYWxpemVkfSlgLFxuICAgICAgICAgIGxhYmVsOiBgJHttaW59IHRvICR7bWF4fSAke3Rva2Vuc1sxXX1gLFxuICAgICAgICB9XG4gICAgfVxuICB9XG59XG4iXX0=